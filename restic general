#!/usr/bin/env bash
set -euo pipefail

REPO="rclone:gdrive_crypt:backup"
PASSFILE="$HOME/.config/restic/password"
LOG="$HOME/restic_log/weekly-$(date +%F).log"

{
  echo "=== Weekly backup start $(date) ==="

  restic backup /data \
    --repo "$REPO" \
    --password-file "$PASSFILE" \
    --tag weekly

  restic forget \
    --repo "$REPO" \
    --password-file "$PASSFILE" \
    --keep-weekly 8 \
    --keep-monthly 6 \
    --keep-yearly 1 \
    --prune \
    --max-unused 5%

  echo "=== Weekly backup end $(date) ==="
} >> "$LOG" 2>&1
